<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>mpvserve</title>
  <link href="/public/main.css" rel="stylesheet">
  <link rel="icon" href="/public/icons/video.svg">
</head>
<body>

<h1>Browsing {{current_path}}</h1>

<div class="wrapper dir">
  {{#unless (eq current_path "./")}}
    <div class="row">
      <a href="..">
        <div class="icon1 dir"></div>
        <div class="link_text">..</div>
      </a>
    </div>
  {{/unless}}
  {{#each result.dirs}}
    <div class="row">
      <a href="{{link}}">
        <div class="icon1 dir"></div>
        <div class="link_text">{{name}}</div>
      </a>
    </div>
  {{/each}}
</div>
<br />
<div class="wrapper movies">
  {{#each result.movies}}
    <div class="row">
      <a href="{{link}}" data-path="{{rel_path}}">
        <div class="flex-container">
          <div class="icon1 video flex-item"></div>
          <div class="link_text flex-item">{{name}}</div>
          {{#if progress}}
            <div class="link_text progress flex-item"
                 data-percentage="{{progress.percentage}}"
                 data-timestamp="{{progress.timestamp}}"
            >
              {{progress.percentage}}%
            </div>
          {{/if}}
        </div>
      </a>
    </div>
  {{/each}}
</div>
<script type=application/javascript>
  document.querySelectorAll(".progress").forEach(el => {
    if (el.dataset.percentage && el.dataset.timestamp) {
      let lastDate = new Date(parseInt(el.dataset.timestamp) * 1000);
      let percentage = parseInt(el.dataset.percentage);
      if (percentage > 90) {
        el.classList.add("viewed");
      }

      el.innerText = `${percentage}% at ${lastDate.toISOString().substring(0, 10)} ${lastDate.toLocaleTimeString("en-GB").substring(0, 5)}`;
    }
  });
</script>

</body>
</html>
